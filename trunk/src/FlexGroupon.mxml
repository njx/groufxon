<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               initialize="initializeHandler(event)"
               resize="resizeHandler(event)"
               applicationDPI="160" 
               xmlns:components="components.*">
 
 
    <fx:Script>
        <![CDATA[           
            import mx.events.ResizeEvent;
            
            import views.DetailView;
 
            // Coordinates
            private const LIST_WIDTH:Number = 400;  // Width of list in Tablet Landscape orientation
            private const LIST_HEIGHT:Number = 300; // Height of list in Tablet Portrait orientation

            private function initializeHandler(event:Event):void
            {
                systemManager.stage.addEventListener(KeyboardEvent.KEY_DOWN, deviceKeyDownHandler);
                systemManager.stage.addEventListener(KeyboardEvent.KEY_UP, deviceKeyUpHandler);
            }
            
            private function resizeHandler(event:ResizeEvent):void
            {
                var isPortrait:Boolean = height > width;
                var isTablet:Boolean = height > 960 || width > 960;
                
                currentState = (isPortrait ? "portrait" : "landscape") + (isTablet ? "Tablet" : "Phone");
            }  
            
            private function deviceKeyDownHandler(event:KeyboardEvent):void
            {
                var key:uint = event.keyCode;
                
                // We want to prevent the default down behavior for back key if 
                // the navigator has a view to pop back to
                if (key == Keyboard.BACK)
                {
                    if (mainNavigator.length > 1)
                        event.preventDefault();
                }
            }
            
            private function deviceKeyUpHandler(event:KeyboardEvent):void
            {
                var key:uint = event.keyCode;
                
                if (key == Keyboard.BACK && mainNavigator.length > 1)
                    mainNavigator.popView();
            }

        ]]>
    </fx:Script>
    <s:states>
        <s:State name="landscapeTablet" stateGroups="landscape, tablet" />
        <s:State name="portraitTablet" stateGroups="portrait, tablet" />
        <s:State name="portraitPhone" stateGroups="portrait, phone" />
        <s:State name="landscapePhone" stateGroups="landscape, phone" />
    </s:states>
    
    <!-- Deal summary list -->
    <components:SummaryList id="dealSummaryList" includeIn="tablet" top="0" left="0" 
            bottom.landscapeTablet="0" right.portraitTablet="0" 
            width.landscapeTablet="{LIST_WIDTH}" height.portraitTablet="{LIST_HEIGHT}"
            change="mainNavigator.replaceView(views.DetailView, dealSummaryList.list.selectedItem)"/>
    
    <!-- ViewNavigator -->
    <s:ViewNavigator id="mainNavigator" left="0" left.landscapeTablet="{LIST_WIDTH}" 
                     top="0" top.portraitTablet="{LIST_HEIGHT}" 
                     right="0" bottom="0" 
                     firstView="views.SummaryView" firstView.tablet="views.DetailView"
                     resize="mainNavigator.scrollRect = new Rectangle(0, 0, mainNavigator.width, mainNavigator.height)">  
    </s:ViewNavigator>
</s:Application>
